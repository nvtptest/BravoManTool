IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[usp_sys_ZipFolder]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[usp_sys_ZipFolder]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[usp_sys_MoveFileFromPath]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[usp_sys_MoveFileFromPath]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[usp_sys_GetBinaryFromFilePath]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[usp_sys_GetBinaryFromFilePath]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[usp_sys_GetBase64FromFilePath]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[usp_sys_GetBase64FromFilePath]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[usp_sys_ZipFromListFileXML]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[usp_sys_ZipFromListFileXML]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ufn_sys_BravoManEncrypt]') AND type IN (N'FS'))
DROP FUNCTION [dbo].[ufn_sys_BravoManEncrypt]
GO

--DROP ASSEMBLY
IF  EXISTS (SELECT * FROM sys.assemblies asms WHERE asms.name = N'BravoManTool')
DROP ASSEMBLY [BravoManTool]
GO
--DROP ASSEMBLY
IF  EXISTS (SELECT * FROM sys.assemblies asms WHERE asms.name = N'System.IO.Compression.FileSystem')
DROP ASSEMBLY [System.IO.Compression.FileSystem]
GO
--DROP ASSEMBLY
IF  EXISTS (SELECT * FROM sys.assemblies asms WHERE asms.name = N'System.IO.Compression')
DROP ASSEMBLY [System.IO.Compression]
GO
CREATE ASSEMBLY [System.IO.Compression]
FROM N'C:\Windows\Microsoft.NET\Framework\v4.0.30319\System.IO.Compression.dll' --Lưu ý đường dẫn cài .Net framework
WITH PERMISSION_SET = UNSAFE;
GO
CREATE ASSEMBLY [System.IO.Compression.FileSystem]
FROM N'C:\Windows\Microsoft.NET\Framework\v4.0.30319\System.IO.Compression.FileSystem.dll' --Lưu ý đường dẫn cài .Net framework
WITH PERMISSION_SET = UNSAFE;
GO

--DROP ASSEMBLY
IF  EXISTS (SELECT * FROM sys.assemblies asms WHERE asms.name = N'System.Windows.Forms')
DROP ASSEMBLY [System.Windows.Forms]
GO
CREATE ASSEMBLY [System.Windows.Forms]
FROM N'C:\Windows\Microsoft.NET\Framework\v4.0.30319\System.Windows.Forms.dll' --Lưu ý đường dẫn cài .Net framework
WITH PERMISSION_SET = UNSAFE;
GO

CREATE ASSEMBLY [BravoManTool]
--FROM 'D:\zProject_DotNet\BravoManTool\BravoManTool\bin\Debug\BravoManTool.dll'
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300A79224CE0000000000000000E00022200B0130000024000000060000000000009642000000200000006000000000001000200000000200000400000000000000060000000000000000A000000002000000000000030060850000100000100000000010000010000000000000100000000000000000000000444200004F00000000600000C003000000000000000000000000000000000000008000000C000000AC410000380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E746578740000009C220000002000000024000000020000000000000000000000000000200000602E72737263000000C0030000006000000004000000260000000000000000000000000000400000402E72656C6F6300000C0000000080000000020000002A00000000000000000000000000004000004200000000000000000000000000000000784200000000000048000000020005002C2900008018000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B300300AC000000010000110072010000700A281100000A0B0703281200000A0C0204281200000A0D000E04130411042C49000805281300000A000918731400000A1305110517731500000A13060011060803281600000A2600DE0D11062C0811066F1700000A00DCDE0D11052C0811056F1700000A00DC002B0A000905281300000A000000DE0E13070011076F1800000A0A00DE00DE180008281900000A130811082C090008281A00000A000000DC0613092B0011092A01340000020042000E50000D0000000002003800275F000D0000000000001D005F7C000E1600000102001D006F8C0018000000001B30030070010000020000110004720100007051281100000A0A731B00000A0D00731C00000A13051105026F1D00000A6F1E00000A001105731F00000A1306732000000A1307110711066F2100000A260318731400000A1308110817731500000A1309000011076F2200000A166F2300000A6F2400000A6F2500000A130A2B5D110A6F2600000A741E000001130B00110B72070000706F2700000A6F2800000A0C0608281200000A0B110B72190000706F2700000A6F2800000A282900000A1304071104281300000A0009076F2A00000A0011090708281600000A2600110A6F2B00000A2D9ADE16110A751F000001130C110C2C08110C6F1700000A00DC00DE0D11092C0811096F1700000A00DCDE0D11082C0811086F1700000A00DC00DE0F130D0004110D6F1800000A5100DE00DE4A0000096F2C00000A130E2B22120E282D00000A130F00110F281900000A131011102C0A00110F281A00000A000000120E282E00000A2DD5DE0F120EFE160200001B6F1700000A00DC00DC2A4194000002000000720000006A000000DC000000160000000000000002000000570000009E000000F50000000D00000000000000020000004D000000B7000000040100000D00000000000000000000001400000000010000140100000F00000016000001020000002F0100002F0000005E0100000F00000000000000020000001400000011010000250100004A000000000000001B300300A700000003000011000E05720100007051281100000A0A0603281200000A0B0204281200000A0C000E040D092C49000705281300000A000818731400000A1304110417731500000A13050011050703281600000A2600DE0D11052C0811056F1700000A00DCDE0D11042C0811046F1700000A00DC002B0A000805281300000A000000DE101306000E0511066F1800000A5100DE00DE180007281900000A130711072C090007281A00000A000000DC2A0001340000020042000E50000D0000000002003800275F000D0000000000001F005D7C00101600000102001F006F8E0018000000001B3003008C000000040000110072310000700A732F00000A0B7275000070733000000A0D0609733100000A13041104733200000A13051105076F3300000A26DE0D11052C0811056F1700000A00DCDE0D11042C0811046F1700000A00DCDE0B092C07096F1700000A00DC076F3400000A0C081672A90000706F3500000A00076F2400000A086F3600000A00076F2400000A13062B0011062A0128000002002A000B35000D00000000020021002344000D00000000020018003B53000B00000000133002003300000005000011000F00283700000A0A062C0C1201FE1526000001070C2B19283800000A0F00283900000A6F3A00000A733B00000A0C2B00082A00133002003300000006000011000F00283C00000A0A062C0C1201FE1527000001070C2B19283800000A0F00283D00000A6F3E00000A733F00000A0C2B00082A001B3002008000000007000011000F00283700000A0C082C0D72B3000070733F00000A0D2B65734000000A0A00060F00283900000A6F4100000A0000DE162600066F4200000A0072B5000070733F00000A0DDE3772B30000700B00066F4300000A0B00DE162600066F4200000A0072D3000070733F00000A0DDE10066F4200000A0007733F00000A0D2B00092A011C000000001F00123100161000000100004D000B580016100000011B3007007800000008000011000472010000705100284400000A0A0203284500000A00284400000A0B041B8D3100000125160450A225177207010070A225181200720B010070284600000A284700000AA225197207010070A2251A1201720B010070284600000A284700000AA2284800000A5100DE0D0C0004086F1800000A5100DE002A0110000000000800626A000D160000011B3002003C0000000900001100000302284900000A734A00000A51047201000070284B00000A812700000100DE190A0003145104066F1800000A284B00000A812700000100DE002A011000000000010021220019160000011B300200500000000A000011000002284900000A0A0306284C00000A284B00000A8127000001047201000070284B00000A812700000100DE220B000314284B00000A812700000104076F1800000A284B00000A812700000100DE002A01100000000001002C2D0022160000011B300300BB0000000B00001100284D00000A0A0006283800000A72330100706F3A00000A6F4E00000A0006283800000A72750100706F3A00000A6F4F00000A0006066F5000000A066F5100000A6F5200000A0B735300000A0C00080717735400000A0D0009735500000A13040011040F00283900000A6F5600000A0000DE0D11042C0811046F1700000A00DC00DE0B092C07096F1700000A00DC086F5700000A284C00000A284B00000A1305DE16082C07086F1700000A00DC062C07066F1700000A00DC11052A0001340000020060001373000D00000000020057002C83000B0000000002004D0055A2000B0000000002000700A6AD000B000000001B300300860000000C000011000002281900000A16FE010B072C0A0005729701007051DE6C020A040C082C39000272D1010070285800000A0D0917285900000A13040011040202285A00000A281600000A2600DE0D11042C0811046F1700000A00DC090A00060317285B00000A000572010000705100DE191305000572DB01007011056F1800000A281200000A5100DE002A0000011C0000020036001349000D00000000000001006B6C0019160000012202285C00000A002A00000042534A4201000100000000000C00000076342E302E33303331390000000005006C00000030070000237E00009C0700008009000023537472696E6773000000001C110000E80100002355530004130000100000002347554944000000141300006C05000023426C6F620000000000000002000001571D02080900000000FA013300160000010000004800000002000000020000000D000000210000005C00000002000000180000000C000000020000000100000007000000000054040100000000000600C50200070600320300070600CE01CA060F00200700000600F60178050600A80278050600740278050600190378050600E50278050600FE0278050600230278050600E201E1060600C001E10606005702780506003E0276030600EF07FE040A0093026A060A00A3006A060A00A9006A060600AD043C000E005A034D050600BE05FE040A000D026A060A0088043A070600010074001200270875041200F60575040A00F607540006008506C5070A00BC08540006002501FE0467009406000006001901C5070A000F0154000A00B00511080A00980011080A005B0611080A001B093A070A00B0033A071600CB089E0706006301FE040A0081073A070600DD06F90806001805F9080600C5043C000600B804F908060035063C00060039043C000600C603FE04060052013C000600C4003C000600CB043C000E00CD004D051A00B3074D050E006F094D051200110675041200ED0075040A00B80054000A008A0554000A009E0554000A008101540006006508FE040A004D06C80506006D0381081E0033083E041600A5049E071A0047014D050600DB05630506001B06FE0406000505F9080600DC00F908060042063C00000000002000000000000100010001001000980498044100010001005180EF0884025180A506840250200000000096002509870201003C210000000096002900910206004C2300000000960044099A02090034240000000096006D08A6020F00F4240000000096001100AF0211003425000000009600E705B802120074250000000096009608C10213001C260000000096002B06CA021400B0260000000096004F07D20217000827000000009600DC03DF021A0074270000000096005508C1021D0070280000000096000F04EC021E0020290000000086189F0606002200000001000604000002002E0500000300A401000004004908000005004501000001008F0400000200A401020003000A08000001000604000002002E0500000300A401000004004908000005004501020006000A08000001008F0400000200A40100000100A00800000100930700000100A008000001003404000002002004020003000A08000001000604020002005C0702000300010100000100060402000200600002000300010100000100AA0800000100CD0300000200F203000003004F01020004000A0809009F06010011009F06060019009F060A0029009F06100031009F06100039009F06100041009F06100049009F06100051009F06100059009F06100061009F06150069009F06100071009F06100079009F06100089009F060600B9009F060600810128042A008901E8072E00910173073400A1009F063B00A9009F064300B10131014D00F9009C010600B100F50057009101D8075B009101B30160000C009F060600D1009F060600C10004069200D1008F009800D9009F069F00E1009F060600E1008004A600E1002F07AF00D901D204B5001101DF07BC00E9019106C200E9003D08C700F100D204CB008100BA035700F1019003D0000C009400D600E9007808DC000C009106E00014003D08F10014007808DC0011019F06060019019F06100021019F06190129019F062101F901650428011101C4082F01F100DB043401E10194003A0139016A04DC00010208004A0139015003570001028A07500131019F06560131016A04DC003101500366010102C3036B0139019F06100041019F06060041016503100009029C01060011028D0857004901B408870119025B098D0121026C0193014901BA0399018901E807A10191016607D00051019F0656013901FE07AC01F101A103BA015901AC01D5013102E708560131024D0056013102DF0866013102460066013102BA06DB0169019F06060071019F06E50179019F06F2014102BA0110006901D708660181013D052E00190229050402810157010D0291011609120281009F0606000E00040022020E000800630220007B00F1032E000B00F5022E001300FE022E001B001D032E00230026032E002B0038032E00330038032E003B003E032E00430026032E004B0052032E00530038032E005B0038032E00630070032E006B009A032E007300A703400083003F05600083003F05800083003F05A0007B004405C0007B004405E0007B004405000183003F0560017B003F05800183003F051A006500F600040140015C0171017C01A701B301C001F9018C00EA000480000001000000000000000000000000009804000004000000000000000000000019026B0000000000040000000000000000000000190254000000000004000000000000000000000019024D0500000000040000000000000000000000190275040000000004000000000000000000000019029E07000000000400000000000000000000001902E404000000000400000000000000000000001902FE040000000000000000004C6973746031006765745F55544638004E56617243686172546F55746638003C4D6F64756C653E007A697046726F6D4C69737446696C65584D4C0053797374656D2E494F006765745F4956007365745F49560053797374656D2E446174610062617365363444617461006D73636F726C69620053797374656D2E436F6C6C656374696F6E732E47656E65726963004C6F6164004164640053716C436F6D6D616E640053797374656D446174614163636573734B696E6400586D6C526561644D6F64650046696C654D6F6465005A6970417263686976654D6F64650043727970746F53747265616D4D6F646500586D6C4E6F6465006765745F4D65737361676500726573756C744D65737361676500446174615461626C650049456E756D657261626C650049446973706F7361626C6500437265617465456E74727946726F6D46696C650069735A697046696C65007A697046696C650047657446696C654E616D65004461746554696D65006765745F496E76617269616E7443756C7475726500496E7465726E616C44617461436F6C6C656374696F6E4261736500446973706F73650066696C654E616D654372656174650044656C65746500577269746500477569644174747269627574650044656275676761626C6541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C795469746C654174747269627574650053716C50726F63656475726541747472696275746500417373656D626C7954726164656D61726B417474726962757465005461726765744672616D65776F726B41747472696275746500417373656D626C7946696C6556657273696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E4174747269627574650053716C46756E6374696F6E41747472696275746500417373656D626C794465736372697074696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E7341747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C79436F6D70616E794174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465006765745F56616C7565005A697041726368697665007365745F52746600456E636F64696E670053797374656D2E52756E74696D652E56657273696F6E696E670046726F6D426173653634537472696E6700546F426173653634537472696E670053716C537472696E6700546F537472696E6700476574537472696E6700736F7572636546696C65506174680047657442617365363446726F6D46696C65506174680064657374696E6174696F6E46696C65506174680066696C6550617468004D6F766546696C6546726F6D50617468007A6970506174680047657454656D7050617468007374617274506174680053797374656D2E436F6D706F6E656E744D6F64656C00427261766F4D616E546F6F6C2E646C6C0046696C6C006765745F49734E756C6C0053797374656D2E586D6C0052656164586D6C0053716C586D6C00696E707574586D6C00427261766F4D616E546F6F6C00436F6E74726F6C0046696C6553747265616D0043727970746F53747265616D004D656D6F727953747265616D006765745F4974656D007365745F4974656D0053797374656D2E494F2E436F6D7072657373696F6E2E46696C6553797374656D0053796D6D6574726963416C676F726974686D004943727970746F5472616E73666F726D004F70656E0066696C654E616D654F726967696E004368616E6765457874656E73696F6E0053797374656D2E494F2E436F6D7072657373696F6E0053797374656D2E476C6F62616C697A6174696F6E0053797374656D2E5265666C656374696F6E00446174615461626C65436F6C6C656374696F6E0044617461526F77436F6C6C656374696F6E0053716C436F6E6E656374696F6E00457863657074696F6E0053797374656D2E446174612E436F6D6D6F6E0043756C74757265496E666F0055746638546F4E5661724368617200586D6C4E6F64655265616465720043726561746552656164657200586D6C5265616465720049466F726D617450726F7669646572007A6970466F6C6465720053747265616D577269746572005465787457726974657200446244617461416461707465720053716C4461746141646170746572004D6963726F736F66742E53716C5365727665722E5365727665720049456E756D657261746F7200476574456E756D657261746F72002E63746F7200496E697469616C697A6174696F6E566563746F7200437265617465456E63727970746F720053797374656D2E446961676E6F7374696373004165730053797374656D2E52756E74696D652E496E7465726F7053657276696365730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F646573006765745F5461626C65730053797374656D2E446174612E53716C54797065730047657446696C6542797465730066696C6542797465730052656164416C6C4279746573005772697465416C6C42797465730053716C427974657300476574427974657300696E70757442797465730053797374656D2E57696E646F77732E466F726D73005A697046696C65457874656E73696F6E730053797374656D2E436F6C6C656374696F6E7300457869737473006765745F526F777300436F6E636174004F626A6563740044617461536574006F705F496D706C6963697400726573756C740053797374656D2E446174612E53716C436C69656E7400586D6C446F63756D656E7400436F6D706F6E656E74006765745F43757272656E740066696C65436F6E74656E7400427261766F4D616E456E637279707400436F6E7665727400726561644C61796F7574004D6F76654E6578740053797374656D2E54657874006765745F5465787400527466546F5465787400696E7075745465787400706C61696E74657874006765745F4E6F770044617461526F77004E6577526F77005269636854657874426F7800546F4172726179006765745F4B6579007365745F4B6579005365637265744B65790053797374656D2E53656375726974792E43727970746F67726170687900436F70790053716C42696E6172790075666E5F7379735F577269746546696C6546726F6D56617242696E61727900777269746546696C6546726F6D56617242696E6172790043726561746546726F6D4469726563746F7279005A697041726368697665456E747279000000054F004B000011460069006C0065004E0061006D0065000017460069006C00650043006F006E00740065006E0074000043530045004C00450043005400200054004F0050002000310020005B00690064005D00460052004F004D00200042003000300055007300650072004C00690073007400003363006F006E007400650078007400200063006F006E006E0065006300740069006F006E0020003D0020007400720075006500000931003200330034000001001D4500720072006F00720020006C006F0061006400200072007400660000334500720072006F007200200063006F006E0076006500720074002000720074006600200074006F002000740065007800740000033B000027640064002F004D004D002F0079007900790079002000480048003A006D006D003A00730073000041420035003000300033004500320046003600360039003400340043004300310039003100310031003700310042004400380045003500350044003100320033000021320035003000430042003100380033003500390042003500340039004200420000394500520052003A002000460069006C00650020006700D11E630020006B006800F4006E00670020007400D31E6E0020007400A11E69002E0001092E007A0069007000000B4500520052003A0020000000A31E1E55571F8B4090856B853482826800042001010803200001052001011111042001010E04200101020F070A0E0E0E0E02125112551259020E0300000E0500020E0E0E060002010E1D05072002010E1180CD092002011280D11180D50900031280DD12550E0E0320000E040001020E040001010E2607110E0E0E151265010E1D051269126D12711251125512751279127D125915118081010E0E0205151265010E0520001280E1062001011280E1062001011280E50820011180E91280E10520001280ED062001128089080520001280F104200012750320001C0420011C0E0500011D050E05200101130003200002092000151180810113000615118081010E04200013000D07080E0E0E02125112551259021407070E128089127912808D128091128095128085072002010E12808D0620010112809106200108128089042000127905200201081C052001011279090703021180991180990500001281010520011D050E052001011D050907030211809D11809D0420001D050520010E1D050A07041280A10E0211809D0A07031180A51180A512590500001180A5050002010E0E0500001281110720020E0E1281150500010E1D0E040701125906000111809D0E0607021D0512590500010E1D051407061280AD1280B11280B51280B91280BD11809D0500001280AD0920021280B11D051D050C2003011280D11280B111811D062001011280D10A07060E02020E1255125908000212550E1180D50400010E0E060003010E0E0208B77A5C561934E089404200350030003000330045003200460036003600390034003400430043003100390031003100310037003100420044003800450035003500440031003200330020320035003000430042003100380033003500390042003500340039004200420002060E0900050E0E0E0E1D05020800030112610E100E0B0006010E0E0E1D0502100E08000212808512610E08000111809911809D08000111809D11809908000111809D11809D070003010E0E100E0C0003010E101280A91011809D0C0003010E1011809D1011809D080004010E0E02100E0801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000701000000001101000C427261766F4D616E546F6F6C00000501000000001301000E425241564F20534F46545741524500001D010018427261766F20436F7079726967687420C2A920203230323100002901002435363462306235662D653338652D343831642D393138632D32346537376531366462626600000C010007312E302E302E3000004901001A2E4E45544672616D65776F726B2C56657273696F6E3D76342E350100540E144672616D65776F726B446973706C61794E616D65122E4E4554204672616D65776F726B20342E35814C01000300540E044E616D651E75666E5F7379735F577269746546696C6546726F6D56617242696E61727954557F4D6963726F736F66742E53716C5365727665722E5365727665722E53797374656D446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038391053797374656D44617461416363657373010000005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A44617461416363657373010000000401000000240100020054020F497344657465726D696E6973746963015402094973507265636973650100000000000000CB9ED39C000000000200000060000000E4410000E42300000000000000000000000000001000000000000000000000000000000052534453B461F1A4BC6FF845A5F747FB84ED16B401000000443A5C7A50726F6A6563745F446F744E65745C427261766F4D616E546F6F6C5C427261766F4D616E546F6F6C5C6F626A5C44656275675C427261766F4D616E546F6F6C2E706462006C42000000000000000000008642000000200000000000000000000000000000000000000000000078420000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058600000640300000000000000000000640334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001000000000000000100000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004C4020000010053007400720069006E006700460069006C00650049006E0066006F000000A002000001003000300030003000300034006200300000001A000100010043006F006D006D0065006E00740073000000000000003E000F00010043006F006D00700061006E0079004E0061006D0065000000000042005200410056004F00200053004F004600540057004100520045000000000042000D000100460069006C0065004400650073006300720069007000740069006F006E000000000042007200610076006F004D0061006E0054006F006F006C0000000000300008000100460069006C006500560065007200730069006F006E000000000031002E0030002E0030002E003000000042001100010049006E007400650072006E0061006C004E0061006D006500000042007200610076006F004D0061006E0054006F006F006C002E0064006C006C00000000005400180001004C006500670061006C0043006F007000790072006900670068007400000042007200610076006F00200043006F0070007900720069006700680074002000A90020002000320030003200310000002A00010001004C006500670061006C00540072006100640065006D00610072006B00730000000000000000004A00110001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000042007200610076006F004D0061006E0054006F006F006C002E0064006C006C00000000003A000D000100500072006F0064007500630074004E0061006D0065000000000042007200610076006F004D0061006E0054006F006F006C0000000000340008000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0030002E00300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000C000000983200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = UNSAFE
GO

CREATE PROCEDURE [dbo].[usp_sys_ZipFolder]
	@_PathFolder [NVARCHAR](256),
	@_ZipPath [NVARCHAR](256),
	@_ResultMessage [NVARCHAR](MAX) OUTPUT
WITH EXECUTE AS CALLER
AS
EXTERNAL NAME [BravoManTool].[BravoManTool.BravoManTool].[zipFolder]
GO

/*
--Đưa toàn bộ các file varbinary nén thành 1 file zip
DECLARE @_XML XML, @_FilePath NVARCHAR(MAX) = 'D:\testZipFile.zip'

SELECT @_XML = 
(	
	SELECT TOP 10 RTRIM(Id) + '.jpg' AS FileName, Image AS FileContent
	FROM dbo.B20ImageStore 
	WHERE Image IS NOT NULL
	FOR XML AUTO, BINARY BASE64,ROOT('root')
)

DECLARE @_ResultMessage NVARCHAR(MAX);
EXECUTE dbo.usp_sys_ZipFromListFileXML 
	@_XML = @_XML, -- xml
	@_FileName = @_FilePath, -- nvarchar(256)
	@_ResultMessage = @_ResultMessage OUTPUT -- nvarchar(max)

PRINT @_ResultMessage
*/
CREATE PROCEDURE [dbo].[usp_sys_ZipFromListFileXML]
	@_XML XML,
	@_FileName [NVARCHAR](256),
	@_ResultMessage [NVARCHAR](MAX) OUTPUT
WITH EXECUTE AS CALLER
AS
EXTERNAL NAME [BravoManTool].[BravoManTool.BravoManTool].[zipFromListFileXML]
GO


/*
--31/08/2023
--Thêm thủ tục lấy giá trị varbinary từ đường dẫn server SQL 
--ResultMessage trả về thành công "OK" hoặc lỗi

DECLARE @_FileBinary VARBINARY(MAX),
        @_ResultMessage NVARCHAR(MAX);
EXEC [dbo].[usp_sys_GetBinaryFromFilePath] @_FilePath = N'D:\test.xml',                        -- nvarchar(max)
                                           @_FileBinary = @_FileBinary OUTPUT,      -- varbinary(max)
                                           @_ResultMessage = @_ResultMessage OUTPUT -- nvarchar(max)

SELECT @_FileBinary, @_ResultMessage
IF @_ResultMessage = 'OK'
	PRINT N'Lấy file thành công'
*/
CREATE PROCEDURE [dbo].[usp_sys_GetBinaryFromFilePath]
	@_FilePath NVARCHAR(MAX),
	@_FileBinary VARBINARY(MAX) OUTPUT,
	@_ResultMessage [NVARCHAR](MAX) OUTPUT
WITH EXECUTE AS CALLER
AS
EXTERNAL NAME [BravoManTool].[BravoManTool.BravoManTool].[GetFileBytes]
GO


CREATE PROCEDURE [dbo].[usp_sys_GetBase64FromFilePath]
    @_FilePath NVARCHAR(MAX),
    @_Base64Data NVARCHAR(MAX) OUTPUT,
    @_ResultMessage NVARCHAR(MAX) OUTPUT
WITH EXECUTE AS CALLER
AS EXTERNAL NAME [BravoManTool].[BravoManTool.BravoManTool].[GetBase64FromFilePath]
GO

-- Tạo hàm CLR
CREATE FUNCTION ufn_sys_BravoManEncrypt(@_PlanText NVARCHAR(MAX))
RETURNS NVARCHAR(MAX)
AS EXTERNAL NAME [BravoManTool].[BravoManTool.BravoManTool].[BravoManEncrypt];
GO


--21/11/2023 thêm hàm move file từ đường dẫn A sang đường dẫn B, và có hỗ trợ @_IsZipFile zip file trước khi chuyển
CREATE PROCEDURE [dbo].[usp_sys_MoveFileFromPath]
    @_SourceFilePath NVARCHAR(MAX),
    @_DestFilePath NVARCHAR(MAX),
    @_IsZipFile BIT,
    @_ResultMessage NVARCHAR(MAX) OUTPUT
WITH EXECUTE AS CALLER
AS EXTERNAL NAME [BravoManTool].[BravoManTool.BravoManTool].[MoveFileFromPath]
GO

